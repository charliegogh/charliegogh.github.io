---
title: js中的闭包
date: 2018-11-14
categories: js
---

## 什么是闭包
  对闭包而言大致有以下两种理解:   
  理解一:闭包是嵌套的内部函数       
  理解二:包含被引用变量(函数)的对象(极少数人)也就是说闭包总是存在于嵌套的内部函数之中   
  
## 闭包是如何产生的呢? 
  当一个嵌套的内部(子)函数引用了嵌套的外部的(父)函数的变量(函数)时,就产生了闭包
  
## 产生闭包的条件
  1. 函数嵌套
  2. 内部函数引用了外部函数的数据(变量/函数)
 
## 闭包有什么特点
   -占用更多内存
   -不容易被释放
   
## 如何查看闭包
   使用 chrome 调试查看
代码实例:
```javascript
    function fn1() {
        var a=2
        var b='abc'
         function fn2() {  //执行函数定义就会产生闭包(不用调用函数内部)     在函数定义之前
            console.log(a)
        }
/*
        这种定义是不会产生闭包的,因为函数还未声明,不去产生调用
        var fn2=function(){
            console.log(a)
        }
*/

        fn2()//调用内部函数
    }
    fn1()
```
## 常见闭包有哪些?
常见的闭包可分为以下两个情况:
   1.将函数作为另一个函数的返回值
   2.将函数作为实参传递给另一个函数调用
```javascript

    /*整个过程中值有一个闭包,将函数作为另一个函数的返回值*/
        function fn1() {
            var a=2;
            function fn2() {
                a++;
                console.log(a)
            }
            return fn2
        }
    var f=fn1();
    f(); //3
    f(); //4
//将函数作为实参传递给另一个函数调用
    function showDelay(msg,time) {
        setTimeout(function () {
            alert(msg)   //产生一个闭包
        },time)
    }
    showDelay("charlie",3000)

```

## 闭包的作用
1. 使用函数内部执行变量在函数执行完之后,仍然存活在内存之中(延长了局部变量的生命周期)
2.让函数外部可以操作(读写)到函数内部的数据(变量/函数)

## 两个问题：
1.函数执行之后,函数内部声明的局部变量是否还存在?    
  一般是不会存在,存在闭包的时候才会存在
2.在函数外部能直接访问函数内部的局部变量吗?   不能,但是可以用闭包来操作它
代码示例：
```javascript
function fn1() {
    var a=2;
    function fn2() {
        a++;
        console.log(a)
    }
    function fn3() {
        a--;
        console.log(a)
    }
    return fn3
//    fn3变量释放,函数对象没有变成垃圾对象,因为是 f 在引用..

}
var f=fn1();
f(); //3
f(); //0

```
 
## 闭包的生命周期
产生:在嵌套内部函数定义执行完时就产生了(不是在调用)
死亡:在嵌套内部成为垃圾对象时
代码实例:
```javascript
    function fn1() {
        //此时闭包就产生 原因内部函数对象已经创建
        var a=2;
        function fn2(){
            a++;
            console.log(a)
        }
        return fn2
    }
    var f=fn1()
    f()
    f()
    f=null; //闭包死亡(包含闭包的函数对象成为了垃圾对象)
```

## 闭包有什么缺点
缺点:
 函数执行完折后,函数内部的局部变量释放,占用内存时间会变长容易造成内存泄漏。
解决方式:
 能不用闭包就不用及时释放。
 
 
 
